SELECT I.*,Datediff(d,I.BildirimTarihi,I.TeslimTarihi) As HarcananSure,Datediff(d,I.BildirimTarihi,IsNull(I.ReelOperationdate,I.TeslimTarihi)) As HarcananSure2,F.FirmaName,P.Adi AS ProjeName,D.Adi AS DurumName,O.Adi AS OnemDereceName,U.UserName,'' as SonYorum ,Case When I.MainIssueID Is Not Null Then t2.Baslik Else Null End As MainBaslik,Case When I.MainIssueID Is Not Null Then t2.IndexID Else I.IndexID End As PNR,YaziRengi=(SELECT Top 1 t10.Kodu FROM SecurityRoles t3 LEFT OUTER JOIN SecurityUserRoles t4 ON t4.RoleID=t3.RoleID LEFT OUTER JOIN SecurityUsers t6 ON t4.UserID=t6.UserID LEFT JOIN YaziRenkleri t10 ON t3.YaziRenkleriID=t10.YaziRenkleriID Where t6.UserName=I.CreatedBy) FROM Issue AS I WITH (NOLOCK) LEFT OUTER JOIN  Firma AS F ON  I.FirmaID=F.IndexId Left Outer Join Issue t2 On I.MainIssueID=t2.IndexId LEFT OUTER JOIN Proje AS P ON I.ProjeID=P.IndexId LEFT OUTER JOIN OnemDereceleri AS O ON I.OnemDereceID=O.IndexId LEFT OUTER JOIN VirusSinif Vrs ON I.VirusSinifId=Vrs.IndexId LEFT OUTER JOIN Durum AS D ON I.DurumID=D.IndexId LEFT OUTER JOIN SecurityUsers AS U ON I.UserID=U.IndexId WHERE I.Active='1'  AND I.BildirimTarihi>=@StartDate AND I.BildirimTarihi<DateAdd(hour,24,@EndDate) ORDER BY I.IndexId DESC UNION ALL 
SELECT I.*,Datediff(d,I.BildirimTarihi,I.TeslimTarihi) As HarcananSure,Datediff(d,I.BildirimTarihi,IsNull(I.ReelOperationdate,I.TeslimTarihi)) As HarcananSure2,F.FirmaName,P.Adi AS ProjeName,D.Adi AS DurumName,O.Adi AS OnemDereceName,U.UserName,'' as SonYorum ,Case When I.MainIssueID Is Not Null Then t2.Baslik Else Null End As MainBaslik,Case When I.MainIssueID Is Not Null Then t2.IndexID Else I.IndexID End As PNR,YaziRengi=(SELECT Top 1 t10.Kodu FROM SecurityRoles t3 LEFT OUTER JOIN SecurityUserRoles t4 ON t4.RoleID=t3.RoleID LEFT OUTER JOIN SecurityUsers t6 ON t4.UserID=t6.UserID LEFT JOIN YaziRenkleri t10 ON t3.YaziRenkleriID=t10.YaziRenkleriID Where t6.UserName=I.CreatedBy) FROM ClosedIssue AS I WITH (NOLOCK) LEFT OUTER JOIN  Firma AS F ON  I.FirmaID=F.IndexId Left Outer Join ClosedIssue t2 On I.MainIssueID=t2.IndexId LEFT OUTER JOIN Proje AS P ON I.ProjeID=P.IndexId LEFT OUTER JOIN OnemDereceleri AS O ON I.OnemDereceID=O.IndexId LEFT OUTER JOIN VirusSinif Vrs ON I.VirusSinifId=Vrs.IndexId LEFT OUTER JOIN Durum AS D ON I.DurumID=D.IndexId LEFT OUTER JOIN SecurityUsers AS U ON I.UserID=U.IndexId WHERE I.Active='1'  AND I.BildirimTarihi>=@StartDate AND I.BildirimTarihi<DateAdd(hour,24,@EndDate) ORDER BY I.IndexId DESC
